FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive
RUN apt -y update
RUN apt install -y curl unzip wget git build-essential
RUN mkdir -p /java-env
ENV WORKSPACE_BASE="/"
COPY ./java-env/jdk1.8.0_202 $WORKSPACE_BASE/java-env/jdk1.8.0_202
COPY ./java-env/gradle-6.8.2 $WORKSPACE_BASE/java-env/gradle-6.8.2
ENV PATH=$PATH:$WORKSPACE_BASE/java-env/gradle-6.8.2/bin:$WORKSPACE_BASE/java-env/jdk1.8.0_202/bin
ENV JAVA_HOME=$WORKSPACE_BASE/java-env/jdk1.8.0_202
ENV PATH=$PATH:$JAVA_HOME/bin
COPY ./project-sources/xwiki__xwiki-rendering_CVE-2023-32070_14.6 /project
COPY ./resources/my-agent/target/agent-fat.jar /project/.agent-fat.jar
ENV JAVA_TOOL_OPTIONS="-javaagent:/project/.agent-fat.jar"
WORKDIR /project
# Do not modify anything above this line
RUN gradle build --parallel
