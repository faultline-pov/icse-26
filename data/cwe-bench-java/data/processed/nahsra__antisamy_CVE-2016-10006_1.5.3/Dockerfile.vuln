FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive
RUN apt -y update
RUN apt install -y curl unzip wget git build-essential
RUN mkdir -p /java-env
ENV WORKSPACE_BASE="/"
COPY ./java-env/jdk-17.0.12 $WORKSPACE_BASE/java-env/jdk-17.0.12
COPY ./java-env/apache-maven-3.9.10 $WORKSPACE_BASE/java-env/apache-maven-3.9.10
ENV PATH=$PATH:$WORKSPACE_BASE/java-env/apache-maven-3.9.10/bin:$WORKSPACE_BASE/java-env/jdk-17.0.12/bin
ENV JAVA_HOME=$WORKSPACE_BASE/java-env/jdk-17.0.12
ENV PATH=$PATH:$JAVA_HOME/bin
COPY ./project-sources/nahsra__antisamy_CVE-2016-10006_1.5.3 /project
COPY ./resources/my-agent/target/agent-fat.jar /project/.agent-fat.jar
ENV JAVA_TOOL_OPTIONS="-javaagent:/project/.agent-fat.jar"
WORKDIR /project
# Do not modify anything above this line
RUN mvn clean package -B -V -e -Dfindbugs.skip -Dcheckstyle.skip -Dpmd.skip=true -Dspotbugs.skip -Denforcer.skip -Dmaven.javadoc.skip -DskipTests -Dmaven.test.skip.exec -Dlicense.skip=true -Drat.skip=true -Dspotless.check.skip=true -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn
